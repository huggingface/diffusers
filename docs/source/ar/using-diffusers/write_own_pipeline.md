# ููู ุงูุฃูุงุจูุจ ูุงูููุงุฐุฌ ูุฌุฏููุฉ ุงูููุงุนูุฏ

[[open-in-colab]]

๐งจ ุตูููุช Diffusers ูุชููู ุตูุฏูู ุฃุฏูุงุช ุณูู ุงูุงุณุชุฎุฏุงู ููุฑู ูุจูุงุก ุฃูุธูุฉ ุงูุงูุชุดุงุฑ ุงููุฎุตุตุฉ ูุญุงูุชู ุงูุงุณุชุฎุฏุงููุฉ. ููุนุฏ ุงููููุฐุฌุงู ูุฌุฏููุฉ ุงูููุงุนูุฏ ููุง ุฌููุฑ ุตูุฏูู ุงูุฃุฏูุงุช. ูู ุญูู ุฃู [`DiffusionPipeline`] ูุฌูุน ุจูู ูุฐู ุงูููููุงุช ูุนูุง ููุฑุงุญุฉุ ููููู ุฃูุถูุง ูู ุญุฒู ุงูุฃูุจูุจ ูุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุฌุฏููุฉ ุงูููุงุนูุฏ ุจุดูู ูููุตู ูุฅูุดุงุก ุฃูุธูุฉ ุงูุชุดุงุฑ ุฌุฏูุฏุฉ.

ูู ูุฐุง ุงูุจุฑูุงูุฌ ุงูุชุนููููุ ุณุชุชุนูู ููููุฉ ุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุฌุฏููุฉ ุงูููุงุนูุฏ ูุชุฌููุน ูุธุงู ุงูุชุดุงุฑ ููุงุณุชุฏูุงูุ ุจุฏุกูุง ูู ุฎุท ุฃูุงุจูุจ ุฃุณุงุณู ุซู ุงูุงูุชูุงู ุฅูู ุฎุท ุฃูุงุจูุจ Stable Diffusion.

## ูู ุฎุท ุฃูุงุจูุจ ุฃุณุงุณู

ูุนุฏ ุฎุท ุงูุฃูุงุจูุจ ุทุฑููุฉ ุณุฑูุนุฉ ูุณููุฉ ูุชุดุบูู ูููุฐุฌ ููุงุณุชุฏูุงูุ ููุง ูุชุทูุจ ุฃูุซุฑ ูู ุฃุฑุจุนุฉ ุฃุณุทุฑ ูู ุงูุชุนูููุงุช ุงูุจุฑูุฌูุฉ ูุชูููุฏ ุตูุฑุฉ:

```py
>>> from diffusers import DDPMPipeline

>>> ddpm = DDPMPipeline.from_pretrained("google/ddpm-cat-256", use_safetensors=True).to("cuda")
>>> image = ddpm(num_inference_steps=25).images[0]
>>> image
```

<div class="flex justify-center">
<img src="https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/diffusers/ddpm-cat.png" alt="ุตูุฑุฉ ูุทุฉ ุชู ุฅูุดุงุคูุง ูู DDPMPipeline" />
</div>

ูุงู ุฐูู ุณููุงู ููุบุงูุฉุ ูููู ููู ูุงู ุฎุท ุงูุฃูุงุจูุจ ุจุฐููุ ุฏุนููุง ูููู ุจุชูููู ุฎุท ุงูุฃูุงุจูุจ ููููู ูุธุฑุฉ ุนูู ูุง ูุญุฏุซ ุฎูู ุงูููุงููุณ.

ูู ุงููุซุงู ุฃุนูุงูุ ูุญุชูู ุฎุท ุงูุฃูุงุจูุจ ุนูู ูููุฐุฌ [`UNet2DModel`] ููุฎุทุท [`DDPMScheduler`]. ูููู ุฎุท ุงูุฃูุงุจูุจ ุจุฅุฒุงูุฉ ุถูุถุงุก ุงูุตูุฑุฉ ุนู ุทุฑูู ุฃุฎุฐ ุถูุถุงุก ุนุดูุงุฆูุฉ ุจุญุฌู ุงูุฅุฎุฑุงุฌ ุงููุทููุจ ููุฑูุฑู ุนุจุฑ ุงููููุฐุฌ ุนุฏุฉ ูุฑุงุช. ูู ูู ุฎุทูุฉ ุฒูููุฉุ ูุชูุจุฃ ุงููููุฐุฌ ุจ *ุจูุงูุง ุงูุถูุถุงุก* ููุณุชุฎุฏููุง ุงูุฌุฏูู ุงูุฒููู ููุชูุจุค ุจุตูุฑุฉ ุฃูู ุถูุถุงุก. ููุฑุฑ ุฎุท ุงูุฃูุงุจูุจ ูุฐู ุงูุนูููุฉ ุญุชู ูุตู ุฅูู ููุงูุฉ ุนุฏุฏ ุฎุทูุงุช ุงูุงุณุชุฏูุงู ุงููุญุฏุฏุฉ.

ูุฅุนุงุฏุฉ ุฅูุดุงุก ุฎุท ุงูุฃูุงุจูุจ ูุน ุงููููุฐุฌ ูุงูุฌุฏูู ุงูุฒููู ุจุดูู ูููุตูุ ุฏุนููุง ููุชุจ ุนูููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ุงูุฎุงุตุฉ ุจูุง.

1. ูู ุจุชุญููู ุงููููุฐุฌ ูุงูุฌุฏูู ุงูุฒููู:

```py
>>> from diffusers import DDPMScheduler, UNet2DModel

>>> scheduler = DDPMScheduler.from_pretrained("google/ddpm-cat-256")
>>> model = UNet2DModel.from_pretrained("google/ddpm-cat-256", use_safetensors=True).to("cuda")
```

2. ูู ุจุชุนููู ุนุฏุฏ ุงูุฎุทูุงุช ุงูุฒูููุฉ ูุชุดุบูู ุนูููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก:

```py
>>> scheduler.set_timesteps(50)
```

3. ูุคุฏู ุชุนููู ุงูุฎุทูุงุช ุงูุฒูููุฉ ููุฌุฏูู ุงูุฒููู ุฅูู ุฅูุดุงุก ูุตูููุฉ ุฐุงุช ุนูุงุตุฑ ูุชุจุงุนุฏุฉ ุจุงูุชุณุงููุ 50 ูู ูุฐุง ุงููุซุงู. ููุงุจู ูู ุนูุตุฑ ุฎุทูุฉ ุฒูููุฉ ูููู ูููุง ุงููููุฐุฌ ุจุฅุฒุงูุฉ ุถูุถุงุก ุงูุตูุฑุฉ. ุนูุฏูุง ุชููู ุจุฅูุดุงุก ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ูุงุญููุงุ ูุณุชููู ุจุงูุชุนููู ุนูู ูุฐู ุงููุตูููุฉ ูุฅุฒุงูุฉ ุถูุถุงุก ุงูุตูุฑุฉ:

```py
>>> scheduler.timesteps
tensor([980, 960, 940, 920, 900, 880, 860, 840, 820, 800, 780, 760, 740, 720,
700, 680, 660, 640, 620, 600, 580, 560, 540, 520, 500, 480, 460, 440,
420, 400, 380, 360, 340, 320, 300, 280, 260, 240, 220, 200, 180, 160,
140, 120, 100,  80,  60,  40,  20,   0])
```

4. ูู ุจุฅูุดุงุก ุจุนุถ ุงูุถูุถุงุก ุงูุนุดูุงุฆูุฉ ุจููุณ ุดูู ุงูุฅุฎุฑุงุฌ ุงููุทููุจ:

```py
>>> import torch

>>> sample_size = model.config.sample_size
>>> noise = torch.randn((1, 3, sample_size, sample_size), device="cuda")
```

5. ุงูุชุจ ุงูุขู ุญููุฉ ููุชุนููู ุนูู ุงูุฎุทูุงุช ุงูุฒูููุฉ. ูู ูู ุฎุทูุฉ ุฒูููุฉุ ูููู ุงููููุฐุฌ ุจุชูููุฐ ุชูุฑูุฑุฉ [`UNet2DModel.forward`] ููุนูุฏ ุจูุงูุง ุงูุถูุถุงุก. ุชุณุชุฎุฏู ุทุฑููุฉ [`~DDPMScheduler.step`] ุงูุฎุงุตุฉ ุจุงูุฌุฏูู ุงูุฒููู ุจูุงูุง ุงูุถูุถุงุก ูุงูุฎุทูุฉ ุงูุฒูููุฉ ูุงูุฅุฏุฎุงู ููุชูุจุค ุจุงูุตูุฑุฉ ูู ุงูุฎุทูุฉ ุงูุฒูููุฉ ุงูุณุงุจูุฉ. ูุตุจุญ ูุฐุง ุงูุฅุฎุฑุงุฌ ุงูุฅุฏุฎุงู ุงูุชุงูู ูููููุฐุฌ ูู ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุกุ ูุณูู ูุชูุฑุฑ ุญุชู ูุตู ุฅูู ููุงูุฉ ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ".

```py
>>> input = noise

>>> for t in scheduler.timesteps:
...     with torch.no_grad():
...         noisy_residual = model(input, t).sample
...     previous_noisy_sample = scheduler.step(noisy_residual, t, input).prev_sample
...     input = previous_noisy_sample
```

ูุฐู ูู ุนูููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ุจุฃููููุงุ ูููููู ุงุณุชุฎุฏุงู ูุฐุง ุงูููุท ููุณู ููุชุงุจุฉ ุฃู ูุธุงู ุงูุชุดุงุฑ.

6. ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุชุญููู ุงูุฅุฎุฑุงุฌ ุงููุฒุงู ุถูุถุงุคู ุฅูู ุตูุฑุฉ:

```py
>>> from PIL import Image
>>> import numpy as np

>>> image = (input / 2 + 0.5).clamp(0, 1).squeeze()
>>> image = (image.permute(1, 2, 0) * 255).round().to(torch.uint8).cpu().numpy()
>>> image = Image.fromarray(image)
>>> image
```

ูู ุงููุณู ุงูุชุงููุ ุณุชุฎุชุจุฑ ููุงุฑุงุชู ุนู ุทุฑูู ุชูููู ุฎุท ุฃูุงุจูุจ Stable Diffusion ุงูุฃูุซุฑ ุชุนููุฏูุง. ุงูุฎุทูุงุช ูู ููุณูุง ุชูุฑูุจูุง. ุณุชููู ุจุชููุฆุฉ ุงูููููุงุช ุงููุงุฒูุฉุ ูุชุนููู ุนุฏุฏ ุงูุฎุทูุงุช ุงูุฒูููุฉ ูุฅูุดุงุก ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ". ูุชู ุงุณุชุฎุฏุงู ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ" ูู ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุกุ ููู ูู ุนูุตุฑ ูู ูุฐุง ุงูุตูููุ ูุชูุจุฃ ุงููููุฐุฌ ุจุตูุฑุฉ ุฃูู ุถูุถุงุก. ุชุชุนููู ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ุนูู "ุงูุฎุทูุงุช ุงูุฒูููุฉ"ุ ููู ูู ุฎุทูุฉ ุฒูููุฉุ ุชููู ุจุฅุฎุฑุงุฌ ุจูุงูุง ุงูุถูุถุงุก ููุณุชุฎุฏููุง ุงูุฌุฏูู ุงูุฒููู ููุชูุจุค ุจุตูุฑุฉ ุฃูู ุถูุถุงุก ูู ุงูุฎุทูุฉ ุงูุฒูููุฉ ุงูุณุงุจูุฉ. ุชุชูุฑุฑ ูุฐู ุงูุนูููุฉ ุญุชู ุชุตู ุฅูู ููุงูุฉ ุตููู "ุงูุฎุทูุงุช ุงูุฒูููุฉ".

ุฏุนููุง ูุฌุฑุจ ุฐูู!

## ูู ุฎุท ุฃูุงุจูุจ Stable Diffusion

Stable Diffusion ูู ูููุฐุฌ ุงูุชุดุงุฑ ูุตู ุฅูู ุตูุฑุฉ *latent*. ูุทูู ุนููู ูููุฐุฌ ุงูุชุดุงุฑ ุฎูู ูุฃูู ูุนูู ูุน ุชูุซูู ููุฎูุถ ุงูุฃุจุนุงุฏ ููุตูุฑุฉ ุจุฏูุงู ูู ูุณุงุญุฉ ุงูุจูุณู ุงููุนููุฉุ ููุง ูุฌุนูู ุฃูุซุฑ ููุงุกุฉ ูู ุงูุฐุงูุฑุฉ. ูููู ุงููุดูุฑ ุจุถุบุท ุงูุตูุฑุฉ ุฅูู ุชูุซูู ุฃุตุบุฑุ ููุชู ุงุณุชุฎุฏุงู ูู ุชุดููุฑ ูุชุญููู ุงูุชูุซูู ุงููุถุบูุท ูุฑุฉ ุฃุฎุฑู ุฅูู ุตูุฑุฉ. ุจุงููุณุจุฉ ูููุงุฐุฌ ุงููุต ุฅูู ุงูุตูุฑุฉุ ุณุชุญุชุงุฌ ุฅูู ูุญุฏุฏ ููุถุน ููุดูุฑ ูุฅูุดุงุก ุชุถูููุงุช ูุตูุฉ. ูู ุงููุซุงู ุงูุณุงุจูุ ุฃูุช ุชุนุฑู ุจุงููุนู ุฃูู ุจุญุงุฌุฉ ุฅูู ูููุฐุฌ UNet ููุฎุทุท.

ููุง ุชุฑููุ ูุฐุง ุฃูุซุฑ ุชุนููุฏูุง ุจุงููุนู ูู ุฎุท ุฃูุงุจูุจ DDPM ุงูุฐู ูุญุชูู ููุท ุนูู ูููุฐุฌ UNet. ูุญุชูู ูููุฐุฌ Stable Diffusion ุนูู ุซูุงุซุฉ ููุงุฐุฌ ูููุตูุฉ ูุณุจููุง.

<Tip>
๐ก ุงูุฑุฃ ูุฏููุฉ [ููู ูุนูู Stable Diffusionุ](Https://huggingface.co/blog/stable_diffusion#how-does-stable-diffusion-work) ููุฒูุฏ ูู ุงูุชูุงุตูู ุญูู ููููุฉ ุนูู ููุงุฐุฌ VAE ูUNet ููุดูุฑ ุงููุต.
</Tip>

ุงูุขู ุจุนุฏ ุฃู ุนุฑูุช ูุง ุชุญุชุงุฌู ูุฎุท ุฃูุงุจูุจ Stable Diffusionุ ูู ุจุชุญููู ุฌููุน ูุฐู ุงูููููุงุช ุจุงุณุชุฎุฏุงู ุทุฑููุฉ [`~ModelMixin.from_pretrained`]. ููููู ุงูุนุซูุฑ ุนูููุง ูู ููุทุฉ ุงูุชุญูู ุงููุณุจูุฉ [`runwayml/stable-diffusion-v1-5`] (https://huggingface.co/runwayml/stable-diffusion-v1-5)ุ ููุชู ุชุฎุฒูู ูู ูููู ูู ูุฌูุฏ ูุฑุนู ูููุตู:

```py
>>> from PIL import Image
>>> import torch
>>> from transformers import CLIPTextModelุ CLIPTokenizer
>>> from diffusers import AutoencoderKLุ UNet2DConditionModelุ PNDMScheduler

>>> vae = AutoencoderKL.from_pretrained("CompVis/stable-diffusion-v1-4"ุ subfolder="vae"ุ use_safetensors=True)
>>> tokenizer = CLIPTokenizer.from_pretrained("CompVis/stable-diffusion-v1-4"ุ subfolder="tokenizer")
>>> text_encoder = CLIPTextModel.from_pretrained(
...     "CompVis/stable-diffusion-v1-4"ุ subfolder="text_encoder"ุ use_safetensors=True
... )
>>> unet = UNet2DConditionModel.from_pretrained(
...     "CompVis/stable-diffusion-v1-4"ุ subfolder="unet"ุ use_safetensors=True
... )
```

ุจุฏูุงู ูู ุฌุฏูู [`PNDMScheduler`] ุงูุงูุชุฑุงุถูุ ุงุณุชุจุฏูู ุจุฌุฏูู [`UniPCMultistepScheduler`] ููุนุฑูุฉ ูุฏู ุณูููุฉ ุชูุตูู ุฌุฏูู ุฒููู ูุฎุชูู:

```py
>>> from diffusers import UniPCMultistepScheduler

>>> scheduler = UniPCMultistepScheduler.from_pretrained("CompVis/stable-diffusion-v1-4"ุ subfolder="scheduler")
```

ููุฅุณุฑุงุน ูู ุงูุงุณุชุฏูุงูุ ูู ุจููู ุงูููุงุฐุฌ ุฅูู ูุญุฏุฉ ูุนุงูุฌุฉ ุงูุฑุณููุงุช (GPU) ูุฃููุง ุชุญุชูู ุนูู ุฃูุฒุงู ูุงุจูุฉ ููุชุฏุฑูุจุ ุนูู ุนูุณ ุงูุฌุฏูู ุงูุฒููู:

```py
>>> torch_device = "cuda"
>>> vae.to(torch_device)
>>> text_encoder.to(torch_device)
>>> unet.to(torch_device)
```

### ุฅูุดุงุก ุชุถูููุงุช ูุตูุฉ

ุงูุฎุทูุฉ ุงูุชุงููุฉ ูู ุชููููุฒ ุงููุต ูุชูููุฏ ุงูุชุถูููุงุช. ูุชู ุงุณุชุฎุฏุงู ุงููุต ูุชูููู ูููุฐุฌ UNet ูุชูุฌูู ุนูููุฉ ุงูุงูุชุดุงุฑ ูุญู ุดูุก ูุดุจู ููุฌู ุงููุต.

<Tip>
๐ก ูุญุฏุฏ ูุนููุฉ "guidance_scale" ููุฏุงุฑ ุงููุฒู ุงูุฐู ูุฌุจ ุฅุนุทุงุคู ููุฅุดุงุฑุฉ ุนูุฏ ุฅูุดุงุก ุตูุฑุฉ.
</Tip>

ูุง ุชุชุฑุฏุฏ ูู ุงุฎุชูุงุฑ ุฃู ููุฌู ุชุฑูุฏ ุฅุฐุง ููุช ุชุฑูุฏ ุฅูุดุงุก ุดูุก ุขุฎุฑ!

```py
>>> prompt = ["ุตูุฑุฉ ูุฑูุงุฏ ุงููุถุงุก ูุฑูุจูู ุญุตุงููุง"]
>>> height = 512 # ุงูุงุฑุชูุงุน ุงูุงูุชุฑุงุถู ูู Stable Diffusion
>>> width = 512 # ุงูุนุฑุถ ุงูุงูุชุฑุงุถู ูู Stable Diffusion
>>> num_inference_steps = 25 # ุนุฏุฏ ุฎุทูุงุช ุฅุฒุงูุฉ ุงูุถูุถุงุก
>>> guidance_scale = 7.5 # ูููุงุณ ุงูุชูุฌูู ุงูุฎุงูู ูู ุงูุชุตููู
>>> generator = torch.manual_seed(0) # ุจุฐุฑุฉ ูููุฏ ูุฅูุดุงุก ุงูุถูุถุงุก ุงูุฃูููุฉ
>>> batch_size = len(prompt)
```

ูู ุจุชููููุฒ ุงููุต ูุฅูุดุงุก ุงูุชุถูููุงุช ูู ุงูููุฌู:

```py
>>> text_input = tokenizer(
...     promptุ padding="max_length"ุ max_length=tokenizer.model_max_lengthุ truncation=Trueุ return_tensors="pt"
... )

>>> with torch.no_grad():
...     text_embeddings = text_encoder(text_input.input_ids.to(torch_device))[0]
```

ุณุชุญุชุงุฌ ุฃูุถูุง ุฅูู ุฅูุดุงุก *ุชุถูููุงุช ุงููุต ุบูุฑ ุงููุดุฑูุทุฉ* ููู ุงูุชุถูููุงุช ุงูุฎุงุตุฉ ุจุฑูุฒ ุงูุญุดู. ูุฌุจ ุฃู ูููู ููุฐู ุงูุชุถูููุงุช ููุณ ุงูุดูู (`batch_size` ู`seq_length`) ูุซู ุงูุชุถูููุงุช ุงููุดุฑูุทุฉ `text_embeddings`:

```py
>>> max_length = text_input.input_ids.shape[-1]
>>> uncond_input = tokenizer([""] * batch_sizeุ padding="max_length"ุ max_length=max_lengthุ return_tensors="pt")
>>> uncond_embeddings = text_encoder(uncond_input.input_ids.to(torch_device))[0]
```

ุฏุนููุง ูููู ุจุฏูุฌ ุงูุชุถูููุงุช ุงููุดุฑูุทุฉ ูุบูุฑ ุงููุดุฑูุทุฉ ูู ุฏูุนุฉ ูุชุฌูุจ ุฅุฌุฑุงุก ุชูุฑูุฑูู:

```py
>>> text_embeddings = torch.cat ([uncond_embeddingsุ text_embeddings])
```

### ุฅูุดุงุก ุถูุถุงุก ุนุดูุงุฆูุฉ

ุจุนุฏ ุฐููุ ูู ุจุชูููุฏ ุจุนุถ ุงูุถูุถุงุก ุงูุนุดูุงุฆูุฉ ูููุทุฉ ุจุฏุงูุฉ ูุนูููุฉ ุงูุงูุชุดุงุฑ. ูุฐุง ูู ุงูุชูุซูู ุงูุฎูู ููุตูุฑุฉุ ูุณูุชู ุฅุฒุงูุฉ ุถูุถุงุคู ุชุฏุฑูุฌูุงู. ูู ูุฐู ุงููุฑุญูุฉุ ุงูุตูุฑุฉ "ุงููุงููุฉ" ุฃุตุบุฑ ูู ุฃุจุนุงุฏ ุงูุตูุฑุฉ ุงูููุงุฆูุฉ ูููู ูุฐุง ุฃูุฑ ุทุจูุนู ูุฃู ุงููููุฐุฌ ุณูุญูููุง ุฅูู ุฃุจุนุงุฏ ุงูุตูุฑุฉ ุงูููุงุฆูุฉ 512x512 ูุงุญููุง.

<Tip>
๐ก ูุชู ุชูุณูู ุงูุงุฑุชูุงุน ูุงูุนุฑุถ ุนูู 8 ูุฃู ูููุฐุฌ "vae" ูุญุชูู ุนูู 3 ุทุจูุงุช ุชูููู ุงูุชุฏุฑุฌ. ููููู ุงูุชุญูู ูู ุฐูู ุนู ุทุฑูู ุชุดุบูู ูุง ููู:
```py
2 ** (len (vae.config.block_out_channels) - 1) == 8
```
</Tip>

```py
>>> latents = torch.randn(
...     (batch_sizeุ unet.config.in_channelsุ height // 8ุ width // 8)ุ
...     generator=generatorุ
...     device=torch_deviceุ
... )
```

### ุฅุฒุงูุฉ ุถูุถุงุก ุงูุตูุฑุฉ

ุงุจุฏุฃ ุนู ุทุฑูู ููุงุณ ุงูุฅุฏุฎุงู ุจุชูุฒูุน ุงูุถูุถุงุก ุงูุฃูููุฉุ *sigma*ุ ููููุฉ ูููุงุณ ุงูุถูุถุงุกุ ูุงูุชู ุชููู ูุทููุจุฉ ูุฌุฏููุฉ ุงูููุงุนูุฏ ุงููุญุณูุฉ ูุซู [`UniPCMultistepScheduler`]:

```py
>>> latents = latents * scheduler.init_noise_sigma
```

ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุฅูุดุงุก ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ุงูุชู ุณุชุญูู ุงูุถูุถุงุก ุงูุจุญุชุฉ ูู "latents" ุฅูู ุตูุฑุฉ ููุตููุฉ ุจููุฌูู. ุชุฐูุฑุ ุชุญุชุงุฌ ุญููุฉ ุฅุฒุงูุฉ ุงูุถูุถุงุก ุฅูู ุงูููุงู ุจุซูุงุซุฉ ุฃุดูุงุก:

1. ูู ุจุชุนููู ุงูุฎุทูุงุช ุงูุฒูููุฉ ููุฌุฏูู ุงูุฒููู ูุงุณุชุฎุฏุงููุง ุฃุซูุงุก ุฅุฒุงูุฉ ุงูุถูุถุงุก.
2. ุงูุชุนููู ุนูู ุงูุฎุทูุงุช ุงูุฒูููุฉ.
3. ูู ูู ุฎุทูุฉ ุฒูููุฉุ ุงุชุตู ุจูููุฐุฌ UNet ููุชูุจุค ุจุจูุงูุง ุงูุถูุถุงุก ููุฑุฑูุง ุฅูู ุงูุฌุฏูู ุงูุฒููู ูุญุณุงุจ ุนููุฉ ุงูุถูุถุงุก ุงูุณุงุจูุฉ.

```py
>>> from tqdm.auto import tqdm

>>> scheduler.set_timesteps(num_inference_steps)

>>> for t in tqdm(scheduler.timesteps):
...     # ูู ุจุชูุณูุน latents ุฅุฐุง ููุง ูููู ุจุงูุชูุฌูู ุงูุฎุงูู ูู ุงูุชุตููู ูุชุฌูุจ ุฅุฌุฑุงุก ุชูุฑูุฑูู.
...     latent_model_input = torch.cat ([latents] * 2)

...     latent_model_input = scheduler.scale_model_input (latent_model_inputุ timestep=t)

...     # ุงูุชูุจุค ุจุจูุงูุง ุงูุถูุถุงุก
...     with torch.no_grad():
...         noise_pred = unet (latent_model_inputุ tุ encoder_hidden_states=text_embeddings).sample

...     # ุฃุฏุงุก ุงูุชูุฌูู
...     noise_pred_uncondุ noise_pred_text = noise_pred.chunk (2)
...     noise_pred = noise_pred_uncond + guidance_scale * (noise_pred_text - noise_pred_uncond)

...     # ุงุญุณุจ ุนููุฉ ุงูุถูุถุงุก ุงูุณุงุจูุฉ x_t -> x_t-1
...     latents = scheduler.step (noise_predุ tุ latents).prev_sample
```

### ูู ุชุดููุฑ ุงูุตูุฑุฉ

ุงูุฎุทูุฉ ุงูุฃุฎูุฑุฉ ูู ุงุณุชุฎุฏุงู "vae" ููู ุชุดููุฑ ุงูุชูุซูู ุงูุฎูู ุฅูู ุตูุฑุฉ ูุงูุญุตูู ุนูู ุงูุฅุฎุฑุงุฌ ุงููููู ุจุงุณุชุฎุฏุงู "sample":

```py
# ูุณูู ูุดููุฑ ุตูุฑุฉ latents ุจุงุณุชุฎุฏุงู vae
latents = 1 / 0.18215 * latents
with torch.no_grad():
image = vae.decode (latents).sample
```

ุฃุฎูุฑูุงุ ูู ุจุชุญููู ุงูุตูุฑุฉ ุฅูู `PIL.Image` ูู
## ุงูุฎุทูุงุช ุงูุชุงููุฉ
ูู ุงูุฃูุงุจูุจ ุงูุฃุณุงุณูุฉ ุฅูู ุงููุนูุฏุฉุ ุฑุฃูุช ุฃู ูู ูุง ุชุญุชุงุฌู ุญููุง ููุชุงุจุฉ ูุธุงู ุงูุงูุชุดุงุฑ ุงูุฎุงุต ุจู ูู ุญููุฉ ุฅุฒุงูุฉ ุงูุชุดููุด. ูุฌุจ ุฃู ุชููู ุงูุญููุฉ ุจุถุจุท ุฎุทูุงุช ุงูููุช ูููุฌุฏููุ ูุงูุชูุฑุงุฑ ููููุงุ ูุงูุชุจุฏูู ุจูู ุงุณุชุฏุนุงุก ูููุฐุฌ UNet ููุชูุจุค ุจุจูุงูุง ุงูุถูุถุงุก ูููููุง ุฅูู ุงููุฌุฏูู ูุญุณุงุจ ุงูุนููุฉ ุงููุดูุดุฉ ุงูุณุงุจูุฉ.
ูุฐุง ูู ุญููุง ูุง ุชู ุชุตููู ๐งจ Diffusers ูู ุฃุฌูู: ูุฌุนู ูุชุงุจุฉ ูุธุงู ุงูุงูุชุดุงุฑ ุงูุฎุงุต ุจู ุจุฏูููุฉ ูุณููุฉ ุจุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุงููุฌุฏููุงุช.
ูู ุฎุทูุงุชู ุงูุชุงููุฉุ ูุง ุชุชุฑุฏุฏ ูู:
* ุชุนูู ููููุฉ [ุจูุงุก ูุงููุณุงููุฉ ุจุฎุท ุฃูุงุจูุจ](../using-diffusers/contribute_pipeline) ุฅูู ๐งจ Diffusers. ูุง ูููููุง ุงูุงูุชุธุงุฑ ููุนุฑูุฉ ูุง ุณุชุชูุตู ุฅููู!
* ุงุณุชูุดู [ุฎุทูุท ุงูุฃูุงุจูุจ ุงูููุฌูุฏุฉ](../api/pipelines/overview) ูู ุงูููุชุจุฉุ ูุงูุธุฑ ูุง ุฅุฐุง ูุงู ุจุฅููุงูู ุชูููู ูุจูุงุก ุฎุท ุฃูุงุจูุจ ูู ุงูุตูุฑ ุจุงุณุชุฎุฏุงู ุงูููุงุฐุฌ ูุงููุฌุฏููุงุช ุจุดูู ูููุตู.